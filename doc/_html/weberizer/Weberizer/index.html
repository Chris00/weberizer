<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Weberizer (weberizer.Weberizer)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">weberizer</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Weberizer</span></h1></header><p>Simple templating library. It reads HTML files &quot;with variables&quot;
and can either output an OCaml module (reusable template with some
static checks) or perform substitutions and return the HTML.</p><p>To parametrize the HTML, you can add the following arguments to
any HTML tag:
</p><pre>    ml:content=&quot;&lt;ident&gt;&quot;
    ml:content=&quot;&lt;ident&gt; &lt;arg1&gt; ... &lt;argN&gt;&quot;
    ml:strip=&quot;true&quot;   ml:strip=&quot;if empty&quot;
    ml:replace=&quot;&lt;ident&gt;&quot;</pre><ul><li>The argument <code class="code">ml:content=&quot;v&quot;</code> (<code class="code">v</code> is any valid OCaml variable
name) tells that the content of the HTML tag must be replaced by
the HTML contained in the OCaml variable <code class="code">v</code>.</li><li><code class="code">ml:content=&quot;f v1 ... vN&quot;</code> does the same but uses the return
value of the OCaml function <code class="code">f</code> on the list <code class="code">[v1; ...; vN]</code> as
the replacement HTML.</li><li><code class="code">ml:strip=&quot;true&quot;</code> says that the HTML tag should be removed
and replaced by the content.</li><li><code class="code">ml:strip=&quot;if empty&quot;</code> says that the HTML tag should be removed
only if the replacement content is empty.</li><li><code class="code">ml:replace=&quot;v&quot;</code> is the same as <code class="code">ml:content=&quot;v&quot;</code> except that it
adds <code class="code">ml:strip=&quot;true&quot;</code>.</li></ul><p>A special value of &lt;ident&gt; is &quot;include&quot;. It serves to include the
files passed as arguments and does not define a new function.</p><p>Inside HTML arguments themselves, one can use
</p><ul><li><code class="code">${&lt;ident&gt;}</code> which is replaced by the content (a string) of the
variable &lt;indent&gt;;</li><li><code class="code">${f v1 ... vN}</code> which is replaced by the string returned by the
function <code class="code">f</code> applied to the list <code class="code">[v1; ...; vN]</code>.</li></ul><div class="spec type" id="type-html"><a href="#type-html" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>html</code><code><span class="keyword"> = </span>Nethtml.document list</code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-compile_html"><a href="#val-compile_html" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>compile_html : ?&#8288;trailer_ml:string <span class="keyword">&#8209;&gt;</span> ?&#8288;trailer_mli:string <span class="keyword">&#8209;&gt;</span> ?&#8288;hide:string list <span class="keyword">&#8209;&gt;</span> ?&#8288;module_name:string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">compile_html fname</code> reads the HTML template file <code class="code">fname</code>
(typically a file with extension &quot;.html&quot;) and creates an OCaml
module with functions to fill the variables of the template. The
module will be in files <code class="code">module_name</code>.ml and <code class="code">module_name</code>.mli.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">module_name</span>: the name of the generated module, possibly
preceded by a path to indicate where to save the module file. By
default, it is the basename of <code class="code">fname</code> without its extension.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">trailer_ml</span>: additional code to be appended to the .ml file.
This code can use the functions of the interface (without the
module prefix) to set variables of the template. You set a
variable <code class="code">v</code> using the value of a variable <code class="code">v'</code>, you should use
the construction <code class="code">Set.v tpl (fun t -&gt; ... Get.v' t ...)</code> (which
returns a copy of <code class="code">tpl</code> with <code class="code">v</code> set) to ensure that the value of
<code class="code">v'</code> at the time of rendering is used and not the one present in
<code class="code">tpl</code> when <code class="code">v</code> is set. This is important to maintain the
independence of variables which may be set in any order (even if
documented, the fact that a variable depends on others will lead
to confusion and errors). If you use <code class="code">Get.v</code> inside <code class="code">Set.v</code>,
<code class="code">Get.v</code> will return the previous value of the variable <code class="code">v</code>.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">trailer_mli</span>: additional code to be appended to the .mli file.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">hide</span>: variables of the template that will not be present
in the module interface. This is only interesting if these
variables are used in <code class="code">trailer_ml</code> functions.</li></ul></div></div><div class="spec val" id="val-compile"><a href="#val-compile" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>compile : ?&#8288;module_name:string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">compile fname</code> does the same as <code class="code">compile_html</code> except that
trailer code is taken from <code class="code">fname</code>.ml and <code class="code">fname</code>.mli for the
implementation and interface respectively. Moreover, to hide
the signature of a template variable, say &quot;var&quot;, one can add a
comment <code class="code">(* @hide var *)</code> in <code class="code">fname</code>.mli. Special annotations
are added to the generated module implementation and interface
so errors point back to <code class="code">fname</code>.ml and <code class="code">fname</code>.mli respectively.</p></div></div><div class="spec module" id="module-Binding"><a href="#module-Binding" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Binding/index.html">Binding</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-subst"><a href="#val-subst" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>subst : ?&#8288;base:string <span class="keyword">&#8209;&gt;</span> <a href="Binding/index.html#type-t">Binding.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a></code></div><div class="doc"><p><code class="code">subst b html</code> return <code class="code">html</code> where all variables are substituted
according to the bindings <code class="code">b</code>.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">base</span>: All relative file names in &quot;include&quot; directives are
considered to be relative to <code class="code">base</code>. Default: the current working
directory.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if variable names are not valid or
associated values do not correspond to their usage.</li></ul></div></div><div class="spec val" id="val-read"><a href="#val-read" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read : ?&#8288;base:string <span class="keyword">&#8209;&gt;</span> ?&#8288;bindings:<a href="Binding/index.html#type-t">Binding.t</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a></code></div><div class="doc"><p><code class="code">read fname</code> reads the file <code class="code">fname</code> and returns its content in a
structured form.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">base</span>: All relative file names in &quot;include&quot; directives are
considered to be relative to <code class="code">base</code>. Default: the <code class="code">Filename.dirname</code>
of <code class="code">fname</code>.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">bindings</span>: if provided, perform the substitutions it
mandates. Otherwise, the &quot;raw&quot; HTML is returned (this is the
default).</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_error</span>: if the file cannot be read.</li></ul></div></div><h2>Utilities</h2><div class="spec val" id="val-write_html"><a href="#val-write_html" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>write_html : ?&#8288;doctype:bool <span class="keyword">&#8209;&gt;</span> ?&#8288;perm:int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">write_html html fname</code> writes the textual representation of the
<code class="code">html</code> to the file <code class="code">fname</code>.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">doctype</span>: whether to output a doctype (default: <code class="code">true</code>).</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">perm</span>: the permissions of the created file (default: <code class="code">0o644</code>).
Whatever permissions you specify, the executable bits are
removed.</li></ul></div></div><div class="spec val" id="val-body_of"><a href="#val-body_of" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>body_of : <a href="index.html#type-html">html</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a></code></div><div class="doc"><p><code class="code">body_of html</code> returns the body of the HTML document or the
entire document if no body is found.</p></div></div><div class="spec val" id="val-title_of"><a href="#val-title_of" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>title_of : <a href="index.html#type-html">html</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">title_of html</code> returns the title contained in <code class="code">html</code> (if no
title is present, it will return <code class="code">&quot;&quot;</code>).</p></div></div><div class="spec module" id="module-Path"><a href="#module-Path" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Path/index.html">Path</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-iter_html"><a href="#val-iter_html" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>iter_html : ?&#8288;langs:string list <span class="keyword">&#8209;&gt;</span> ?&#8288;exts:string list <span class="keyword">&#8209;&gt;</span> ?&#8288;filter:(<a href="Path/index.html#type-t">Path.t</a> <span class="keyword">&#8209;&gt;</span> bool) <span class="keyword">&#8209;&gt;</span> ?&#8288;perm:int <span class="keyword">&#8209;&gt;</span> ?&#8288;out_dir:(string <span class="keyword">&#8209;&gt;</span> string) <span class="keyword">&#8209;&gt;</span> ?&#8288;out_ext:(string <span class="keyword">&#8209;&gt;</span> string) <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> (string <span class="keyword">&#8209;&gt;</span> <a href="Path/index.html#type-t">Path.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a>) <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">iter_html base f</code> iterates <code class="code">f lang file</code> on all HTML files under
<code class="code">base</code> (the argument of <code class="code">f</code> is guaranteed to be a path to a file).
The resulting HTML code is written under the directory <code class="code">out_dir
    lang</code>, the subpath begin the relative path of the file
w.r.t. <code class="code">base</code> and the filename is the original one with the
language removed.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if <code class="code">base</code> is not a
directory.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">lang</span>: the accepted languages. The first one being the
default one (for files that do not specify a language).</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if languages are not lowercase only.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">exts</span>: the allowed file extensions. Defaut: <code class="code">[&quot;.html&quot;]</code>.
May be useful, ofr example, if you want to deal PHP pages.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">filter</span>: examine the file of dir iff the condition <code class="code">filter
    rel_dir f</code> holds on the relative path <code class="code">rel_dir</code> from <code class="code">root</code> and
final file or dir <code class="code">f</code>. Default: accept all <code class="code">.html</code> files.
Files and dirs starting with a dot are <i>always</i> excluded.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">out_dir</span>: a function s.t. <code class="code">out_dir lang</code> gives the outpout
directory used for the language <code class="code">lang</code>. Default: the identity.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">out_ext</span>: a function to transform the output extension given
the input one. Default: the identity.</li></ul></div></div><div class="spec val" id="val-relative_url_are_from_base"><a href="#val-relative_url_are_from_base" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>relative_url_are_from_base : <a href="Path/index.html#type-t">Path.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a></code></div><div class="doc"><p><code class="code">relative_url_are_from_base path html</code> prefix all relative URLs
in <code class="code">html</code> so that they are specified according to the directory
given by <code class="code">path</code> instead of the base path.</p></div></div><div class="spec val" id="val-email"><a href="#val-email" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>email : ?&#8288;args:(string<span class="keyword"> * </span>string) list <span class="keyword">&#8209;&gt;</span> ?&#8288;content:<a href="index.html#type-html">html</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a></code></div><div class="doc"><p><code class="code">email e</code> return some HTML/javascript code to protect the email
<code class="code">e</code> from SPAM harvesters. The email <code class="code">e</code> may end with &quot;?...&quot; in
order to specify options, e.g. <code class="code">?subject=...</code>.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">args</span>: arguments to the &lt;a&gt; HTML tag. Default: <code class="code">[]</code>.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">content</span>: Tells whether the content of the email link is
the email itself (no <code class="code">content</code> specified, the default) or some
other data.</li></ul></div></div><div class="spec val" id="val-protect_emails"><a href="#val-protect_emails" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>protect_emails : <a href="index.html#type-html">html</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-html">html</a></code></div><div class="doc"><p><code class="code">protect_emails html</code> changes all emails hrefs in <code class="code">html</code> in
order to make it more difficult for spammers to harvest them.</p></div></div><div class="spec module" id="module-Cache"><a href="#module-Cache" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Cache/index.html">Cache</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Simple cache with dependencies and timeout.</p></div></div></body></html>