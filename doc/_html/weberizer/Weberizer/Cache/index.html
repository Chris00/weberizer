<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cache (weberizer.Weberizer.Cache)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">weberizer</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Weberizer.Cache</span></h1></header><div class="doc"><p>Simple cache with dependencies and timeout.</p></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a t</code><code></code><code></code></div><div class="doc"><p>A cache for elements of type 'a.</p></div></div><div class="spec val" id="val-make"><a href="#val-make" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make : ?&#8288;dep:<span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;new_if:(<span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> bool) <span class="keyword">&#8209;&gt;</span> ?&#8288;timeout:float <span class="keyword">&#8209;&gt;</span> ?&#8288;debug:bool <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span> option <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">make key f</code> create a new cache to hold the return value of <code class="code">f</code>
using the <code class="code">key</code>. <code class="code">f</code> is given its previously returned value if
any â€” it may be less work to update it than recreating it
afresh. The disk cache will be updated when the program exits,
so its content will persist across multiplie runs of the
program. The type <code class="code">'a</code> must be marshal-able.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">timeout</span>: the number of seconds after which the cached
value must be refreshed (running <code class="code">f</code> again). Default: <code class="code">3600.</code>.
A non-positive value means no timeout.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">debug</span>: print messages on <code class="code">stderr</code> about cache usage and
refresh. The string argument is a prefix to these messages to
be able to distinguish different caches. Default: <code class="code">&quot;&quot;</code> i.e.,
no messages.</li></ul></div></div><div class="spec val" id="val-update"><a href="#val-update" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>update : ?&#8288;f:(<span class="type-var">'a</span> option <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">update t</code> update the cache immediately. If <code class="code">f</code> is given, first
set the function generating values for the cache <code class="code">t</code> to <code class="code">f</code> and
then update the cache by running <code class="code">f</code>.</p></div></div><div class="spec val" id="val-depend"><a href="#val-depend" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>depend : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> dep:<span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">depend t t'</code> says that the cache <code class="code">t</code> depends on the cache <code class="code">t'</code>
i.e. that before updating <code class="code">t</code>, one must update <code class="code">t'</code>.</p></div></div><div class="spec val" id="val-get"><a href="#val-get" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get : ?&#8288;update:bool <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"><p>Get the value stored in the cache. This operation will update
the cached value if necessary.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">update</span>: if <code class="code">true</code>, force an update. Default: <code class="code">false</code>.</li></ul></div></div><div class="spec val" id="val-result"><a href="#val-result" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>result : ?&#8288;dep:<span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;new_if:(<span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> bool) <span class="keyword">&#8209;&gt;</span> ?&#8288;timeout:float <span class="keyword">&#8209;&gt;</span> ?&#8288;debug:bool <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span> option <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"><p><code class="code">result key f</code> is a convenience function equivalent to
<code class="code">get(make key f)</code>.</p></div></div><div class="spec val" id="val-time"><a href="#val-time" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>time : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> float</code></div><div class="doc"><p>The time of the last update of the cache. Returns
<code class="code">neg_infinity</code> if the cache is not initialized.</p></div></div><div class="spec val" id="val-key"><a href="#val-key" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>key : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">key t</code> returns the key used to store the value.</p></div></div></body></html>